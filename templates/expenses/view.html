{% extends "base.html" %}

{% block content %}
<style>
.magnify-container {
    overflow: hidden;
}

.magnify-img.magnify-zoom {
    transform: scale(3);
    cursor: zoom-in;
}

.magnify-img {
    will-change: transform;
    transform: translateZ(0);
    transition: transform 0.5s ease;
}
</style>

<div class="max-w-2xl mx-auto
            bg-white dark:bg-[#1a1a1a]
            border border-gray-200 dark:border-gray-700
            rounded-lg p-6 shadow-sm">

  <h2 class="text-xl font-bold mb-4 text-gray-900 dark:text-gray-100">
    Expense Details
  </h2>

  <div class="space-y-3">

    <p class="text-lg font-semibold text-gray-900 dark:text-gray-100">
      Rs. {{ expense.amount }}
    </p>

    <p class="text-sm text-gray-600 dark:text-gray-400 flex items-center gap-2">
      <i class="fas fa-tag text-gray-400"></i>
      {{ expense.category }}
    </p>

    <p class="text-sm text-gray-600 dark:text-gray-400 flex items-center gap-2">
      <i class="fas fa-calendar-alt text-gray-400"></i>
      {{ expense.date.strftime('%B %d, %Y') }}
    </p>

    <p class="text-sm text-gray-600 dark:text-gray-400 flex items-center gap-2">
      <i class="fas fa-user text-gray-400"></i>
      Expense Done By:
      <span class="font-medium text-gray-700 dark:text-gray-300">
        {{ expense.done_by }}
      </span>
    </p>

    {% if expense.note %}
    <p class="text-sm text-gray-700 dark:text-gray-300">
      {{ expense.note }}
    </p>
    {% endif %}

    <hr class="my-4 border-gray-200 dark:border-gray-700">

    <h3 class="font-semibold text-lg mb-3 text-gray-900 dark:text-gray-100">
      Attachments
    </h3>

    {% if expense.attachment %}
    <div class="space-y-3">

      {% set ext = expense.attachment.split('.')[-1].lower() %}

      {% if ext in ['png','jpg','jpeg','webp'] %}
      <div class="receipt-magnifier w-full max-w-xl mx-auto
                  border border-gray-200 dark:border-gray-700
                  rounded-lg
                  bg-white dark:bg-[#111]
                  shadow-sm overflow-hidden">

        <div class="magnify-container relative w-full h-[350px] cursor-zoom-in">
          <img
            src="{{ url_for('receipt_file', filename=expense.attachment) }}"
            class="magnify-img w-full h-full object-contain"
            alt="Receipt Preview"
          >
        </div>
      </div>

      {% else %}
      <a
        href="{{ url_for('receipt_file', filename=expense.attachment) }}"
        target="_blank"
        class="inline-flex items-center gap-2 px-3 py-1.5 text-sm
               border border-gray-200 dark:border-gray-600
               rounded-lg
               bg-gray-50 dark:bg-[#111]
               hover:bg-gray-100 dark:hover:bg-[#1f1f1f]
               transition
               text-gray-700 dark:text-gray-300"
      >
        <i class="fas fa-paperclip text-gray-500 dark:text-gray-400"></i>
        {{ expense.attachment }}
      </a>
      {% endif %}

    </div>
    {% else %}
    <p class="text-sm text-gray-400 dark:text-gray-500">
      No attachments
    </p>
    {% endif %}
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const container = document.querySelector(".magnify-container");
    const img = document.querySelector(".magnify-img");

    if (!container || !img) return;

    container.addEventListener("mouseenter", function () {
        img.classList.add("magnify-zoom");
    });

    container.addEventListener("mousemove", function (e) {
        const rect = container.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        img.style.transformOrigin = `${x}px ${y}px`;
    });

    container.addEventListener("mouseleave", function () {
        img.classList.remove("magnify-zoom");
        img.style.transformOrigin = "center center";
    });
});
</script>
{% endblock %}
