<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <title>Budget Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class'
    };
  </script>

  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap">
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">

  <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.svg') }}">
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='favicon.svg') }}">

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

  <script>
    (function () {
      try {
        if (localStorage.getItem('theme') === 'dark') {
          document.documentElement.classList.add('dark');
        }
      } catch (e) {}
    })();
  </script>

  <style>
    body {
      font-family: 'Inter', sans-serif;
      overflow-x: hidden;
      background-color: #f7f8fa;
      color: #111827;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    html.dark body {
      background-color: #0d0d0d;
      color: #e5e5e5;
    }

    .select2-container .select2-selection--single {
      height: 42px !important;
    }

    .select2-container--default .select2-selection--single .select2-selection__rendered {
      line-height: 38px !important;
      padding-left: 10px !important;
    }

    .select2-container--default .select2-selection--single .select2-selection__arrow {
      height: 38px !important;
      right: 10px !important;
    }

    .dark .select2-container--default .select2-selection--single {
      background-color: #1a1a1a !important;
      border-color: #555 !important;
      color: #ddd !important;
    }

    .dark .select2-container--default .select2-dropdown {
      background-color: #1a1a1a !important;
      border-color: #555 !important;
      color: #ddd !important;
    }

    .dark .select2-results__option {
      background: #1a1a1a !important;
      color: #ddd !important;
    }

    .dark .select2-results__option--highlighted {
      background: #333 !important;
      color: #fff !important;
    }

    @media (max-width: 640px) {
      .container {
        padding-left: 1rem;
        padding-right: 1rem;
      }
    }
  </style>
</head>

<body>

{% if not hide_nav %}
<nav class="bg-white dark:bg-[#111] dark:text-gray-200 shadow-sm border-b dark:border-gray-700 mb-6 transition-colors duration-300">
  <div class="container mx-auto px-4 py-3 flex flex-col sm:flex-row items-center justify-between">
    <a href="{{ url_for('dashboard.index') }}" class="text-[#665191] dark:text-[#a28cff] font-bold text-lg flex items-center gap-2 mb-2 sm:mb-0">
      <i class="fas fa-wallet text-3xl text-[#665191] dark:text-[#a28cff]"></i>
      Track ME!
    </a>

    <div class="flex flex-wrap items-center gap-4 text-sm text-gray-600 dark:text-gray-300">
      <a href="{{ url_for('dashboard.index') }}" class="hover:text-[#0f8238]">Dashboard</a>
      <a href="{{ url_for('expenses.index') }}" class="hover:text-[#0f8238]">Expenses</a>
      <a href="{{ url_for('income.index') }}" class="hover:text-[#0f8238]">Income</a>
      <a href="{{ url_for('history.index') }}" class="hover:text-[#0f8238]">History</a>
      <a href="{{ url_for('settings.index') }}" class="hover:text-[#0f8238]">Settings</a>
      <a href="{{ url_for('auth.logout') }}" class="hover:text-red-600">Logout</a>

      <button id="themeToggle" class="text-gray-600 dark:text-gray-300 hover:text-[#0f8238] text-xl transition">
        <i class="fas fa-moon"></i>
      </button>
    </div>
  </div>
</nav>
{% endif %}

<div class="container mx-auto px-4">
  {% block content %}{% endblock %}
</div>

<script>
  const root = document.documentElement;
  const toggle = document.getElementById('themeToggle');

  function applyThemeFromStorage() {
    const stored = localStorage.getItem('theme');
    const isDark = stored === 'dark';
    root.classList.toggle('dark', isDark);
    if (toggle) {
      toggle.innerHTML = isDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
    }
    updateCharts();
  }

  function updateCharts() {
    const textColor = root.classList.contains('dark') ? '#e5e5e5' : '#333333';
    Chart.defaults.color = textColor;
    if (Chart.instances) {
      Object.values(Chart.instances).forEach(c => c.update());
    }
  }

  applyThemeFromStorage();

  if (toggle) {
    toggle.addEventListener('click', () => {
      const isDark = !root.classList.contains('dark');
      root.classList.toggle('dark', isDark);
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      toggle.innerHTML = isDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
      updateCharts();
    });
  }
</script>

</body>
</html>
