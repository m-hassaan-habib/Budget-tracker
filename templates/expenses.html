{% extends "base.html" %}

<style>
.select2-results__option .opt { display:flex; align-items:center; gap:8px }
.select2-results__option .ico { width:22px; min-width:22px; text-align:center; font-size:16px; line-height:1 }
.select2-container--default .select2-selection__rendered .opt { display:flex; align-items:center; gap:8px }
.select2-container--default .select2-selection--single .select2-selection__rendered .ico {
  width:18px; min-width:18px; text-align:center; font-size:14px; line-height:1;
}
</style>

{% block content %}

<!-- HEADER -->
<div class="flex flex-col sm:flex-row justify-between items-center mb-6">
  <h2 class="text-xl font-bold mb-2 sm:mb-0 text-gray-900 dark:text-gray-200">All Expenses</h2>

  <button
    class="bg-[#0f8238] hover:bg-green-700 text-white text-sm px-4 py-2 rounded shadow-md"
    data-bs-toggle="modal"
    data-bs-target="#addExpenseModal">
    + Add Expense
  </button>
</div>

<!-- EXPENSE LIST -->
<section class="space-y-2">
  {% for expense in expenses %}
  <article
    onclick="window.location='{{ url_for('expenses.view_expense', id=expense.id) }}'"
    class="bg-white dark:bg-[#1a1a1a] border border-gray-200 dark:border-gray-800 rounded-lg
           p-5 shadow-sm flex items-start justify-between gap-4 cursor-pointer
           hover:shadow-lg hover:border-gray-300 dark:hover:border-gray-600 transition"
  >
    <div class="flex-1">
      <div class="flex flex-wrap items-center gap-2 mb-2">

        <p class="font-bold text-lg text-gray-900 dark:text-gray-100">
          Rs. {{ expense.amount }}
        </p>

        <div class="flex items-center text-gray-500 dark:text-gray-400 text-xs">
          <i class="fas fa-tag mr-1"></i>{{ expense.category }}
        </div>

        <div class="flex items-center text-gray-500 dark:text-gray-400 text-xs">
          <i class="fas fa-calendar-alt ml-4 mr-1"></i>{{ expense.date.strftime('%b %d, %Y') }}
        </div>

        {% if expense.attachment %}
        <div class="flex items-center text-gray-500 dark:text-gray-400 text-xs ml-4">
          <i class="fas fa-paperclip mr-1"></i> Attachment
        </div>
        {% endif %}
      </div>

      {% if expense.note %}
      <div class="flex items-center gap-2 text-gray-600 dark:text-gray-300 text-sm">
        <i class="far fa-file-alt"></i>
        <p>{{ expense.note }}</p>
      </div>
      {% endif %}

      {% if expense.done_by %}
      <div class="flex items-center text-gray-500 dark:text-gray-400 text-xs ml-4">
        <i class="fas fa-user mr-1"></i> {{ expense.done_by }}
      </div>
      {% endif %}
    </div>

    <!-- ACTIONS -->
    <div class="flex flex-col justify-center items-center gap-3 text-sm">

      <button
        class="text-indigo-500 dark:text-indigo-400 hover:text-blue-400 dark:hover:text-blue-300"
        onclick="event.stopPropagation();"
        data-bs-toggle="modal"
        data-bs-target="#editExpenseModal{{ expense.id }}">
        <i class="fas fa-edit"></i>
      </button>

      <a href="{{ url_for('expenses.delete_expense', id=expense.id) }}"
        onclick="event.stopPropagation();"
        class="text-amber-500 dark:text-amber-400 hover:text-red-400 dark:hover:text-red-300">
        <i class="fas fa-trash-alt"></i>
      </a>

    </div>
  </article>
  {% endfor %}
</section>

<!-- ADD MODAL -->
<div id="addExpenseModal"
     class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 hidden">

  <div class="bg-white dark:bg-[#1a1a1a] rounded-lg border border-gray-200 dark:border-gray-700
              shadow-xl w-full max-w-md p-6 mx-4 relative">

    <button onclick="closeModal('addExpenseModal')"
            class="absolute top-3 right-3 text-gray-400 dark:text-gray-500 hover:text-gray-300 text-xl">
      &times;
    </button>

    <h2 class="text-lg font-semibold mb-4 text-gray-900 dark:text-gray-100">Add Expense</h2>

    <form method="POST" action="{{ url_for('expenses.add_expense') }}"
          enctype="multipart/form-data" class="space-y-4">

      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Amount</label>
        <input type="number" name="amount" step="0.01" required
          class="w-full border border-gray-300 dark:border-gray-600 dark:bg-[#111] dark:text-gray-200
                 rounded-md shadow-sm focus:ring-[#0f8238] focus:border-[#0f8238] py-2 px-2">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Category</label>
        <select name="category" class="select2 w-full border border-gray-300 dark:border-gray-600 dark:bg-[#111] dark:text-gray-200 rounded-md shadow-sm py-2 px-3" required>
          <option disabled selected value="">Select Category</option>
          <option data-icon="fas fa-gem" data-color="#8b5cf6" value="Acessories">Accessories</option>
          <option data-icon="fas fa-baby-carriage" data-color="#fbbf24" value="Baby Food">Baby Food</option>
          <option data-icon="fas fa-file-invoice-dollar" data-color="#ef4444" value="Bills">Bills</option>
          <option data-icon="fas fa-tshirt" data-color="#3b82f6" value="Clothing">Clothing</option>
          <option data-icon="fas fa-utensils" data-color="#10b981" value="Eat Out">Eat Out</option>
          <option data-icon="fas fa-gift" data-color="#f59e0b" value="Family Gift">Family Gift</option>
          <option data-icon="fas fa-motorcycle" data-color="#f97316" value="Food Delivery">Food Delivery</option>
          <option data-icon="fas fa-shopping-cart" data-color="#22c55e" value="Grocery">Grocery</option>
          <option data-icon="fas fa-home" data-color="#64748b" value="Household Expense">Household Expense</option>
          <option data-icon="fas fa-chart-line" data-color="#0ea5e9" value="Investment">Investment</option>
          <option data-icon="fas fa-hand-holding-usd" data-color="#22c55e" value="Lend Money">Lend Money</option>
          <option data-icon="fas fa-tree" data-color="#16a34a" value="Outdoor">Outdoor</option>
          <option data-icon="fas fa-tools" data-color="#9ca3af" value="Repair">Repair</option>
          <option data-icon="fas fa-shopping-bag" data-color="#8b5cf6" value="Shopping">Shopping</option>
          <option data-icon="fas fa-cookie-bite" data-color="#f59e0b" value="Snacking">Snacking</option>
          <option data-icon="fas fa-plane" data-color="#3b82f6" value="Travel">Travel</option>
          <option data-icon="fas fa-book" data-color="#0ea5e9" value="Education">Education</option>
          <option data-icon="fas fa-heartbeat" data-color="#ef4444" value="Healthcare">Healthcare</option>
          <option data-icon="fas fa-film" data-color="#f472b6" value="Entertainment">Entertainment</option>
          <option data-icon="fas fa-paw" data-color="#84cc16" value="Pets">Pets</option>
          <option data-icon="fas fa-bus" data-color="#6b7280" value="Transportation">Transportation</option>
          <option data-icon="fas fa-dumbbell" data-color="#10b981" value="Fitness">Fitness</option>
          <option data-icon="fas fa-hand-holding-heart" data-color="#ef4444" value="Charity">Charity</option>
          <option data-icon="fas fa-laptop" data-color="#0284c7" value="Electronics">Electronics</option>
          <option data-icon="fas fa-umbrella-beach" data-color="#f59e0b" value="Vacation">Vacation</option>

          <option data-icon="fas fa-lightbulb" data-color="#f59e0b" value="Utilities">Utilities</option>
          <option data-icon="fas fa-home" data-color="#4b5563" value="Rent">Rent</option>
          <option data-icon="fas fa-gas-pump" data-color="#f59e0b" value="Fuel">Fuel</option>
          <option data-icon="fas fa-wifi" data-color="#6366f1" value="Internet">Internet</option>
          <option data-icon="fas fa-mobile-alt" data-color="#06b6d4" value="Phone">Phone</option>
          <option data-icon="fas fa-money-bill-wave" data-color="#16a34a" value="Salary">Salary</option>
          <option data-icon="fas fa-piggy-bank" data-color="#84cc16" value="Savings">Savings</option>
          <option data-icon="fas fa-credit-card" data-color="#ef4444" value="Loan Payment">Loan Payment</option>
          <option data-icon="fas fa-shield-alt" data-color="#0ea5e9" value="Insurance">Insurance</option>
          <option data-icon="fas fa-pills" data-color="#22c55e" value="Pharmacy">Pharmacy</option>
          <option data-icon="fas fa-pen" data-color="#6b7280" value="Stationery">Stationery</option>
          <option data-icon="fas fa-apple-alt" data-color="#22c55e" value="Fruits & Veg">Fruits & Veg</option>
          <option data-icon="fas fa-drumstick-bite" data-color="#ef4444" value="Meat & Poultry">Meat & Poultry</option>
          <option data-icon="fas fa-bread-slice" data-color="#f59e0b" value="Bakery">Bakery</option>
          <option data-icon="fas fa-mug-hot" data-color="#a16207" value="Coffee/Tea">Coffee/Tea</option>
          <option data-icon="fas fa-sim-card" data-color="#06b6d4" value="Mobile Top-up">Mobile Top-up</option>
          <option data-icon="fas fa-redo-alt" data-color="#6366f1" value="Subscriptions">Subscriptions</option>
          <option data-icon="fas fa-code" data-color="#0ea5e9" value="Software">Software</option>
          <option data-icon="fas fa-cloud" data-color="#60a5fa" value="Cloud">Cloud</option>
          <option data-icon="fas fa-server" data-color="#4b5563" value="Hosting">Hosting</option>
          <option data-icon="fas fa-globe" data-color="#10b981" value="Domain">Domain</option>
          <option data-icon="fas fa-tint" data-color="#06b6d4" value="Laundry">Laundry</option>
          <option data-icon="fas fa-broom" data-color="#a3a3a3" value="Cleaning">Cleaning</option>
          <option data-icon="fas fa-seedling" data-color="#16a34a" value="Gardening">Gardening</option>
          <option data-icon="fas fa-hammer" data-color="#f59e0b" value="Home Improvement">Home Improvement</option>
          <option data-icon="fas fa-couch" data-color="#a16207" value="Furniture">Furniture</option>
          <option data-icon="fas fa-blender" data-color="#64748b" value="Appliances">Appliances</option>
          <option data-icon="fas fa-shipping-fast" data-color="#8b5cf6" value="Courier/Shipping">Courier/Shipping</option>
          <option data-icon="fas fa-taxi" data-color="#f59e0b" value="Ride-hailing">Ride-hailing</option>
          <option data-icon="fas fa-parking" data-color="#3b82f6" value="Parking">Parking</option>
          <option data-icon="fas fa-file-invoice" data-color="#ef4444" value="Taxes">Taxes</option>
          <option data-icon="fas fa-ellipsis-h" data-color="#9ca3af" value="Miscellaneous">Miscellaneous</option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Note (optional)</label>
        <textarea name="note" rows="2"
            class="w-full border border-gray-300 dark:border-gray-600 dark:bg-[#111] dark:text-gray-200
                   rounded-md shadow-sm focus:ring-[#0f8238] focus:border-[#0f8238] px-2 py-1">
        </textarea>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Date</label>
        <input type="date" name="date" value="{{ current_date }}" required
          class="w-full border border-gray-300 dark:border-gray-600 dark:bg-[#111] dark:text-gray-200
                 rounded-md shadow-sm focus:ring-[#0f8238] focus:border-[#0f8238] py-2 px-2">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Receipt (optional)</label>
        <input type="file"
               class="w-full text-sm border border-gray-300 dark:border-gray-600 dark:bg-[#111]
                      dark:text-gray-200 rounded-md p-1" name="attachment">
        <p class="text-[11px] text-gray-500 dark:text-gray-400 mt-1">Accepted: PDF, PNG, JPG</p>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Expense Done By</label>
        <select name="done_by"
          class="w-full border border-gray-300 dark:border-gray-600 dark:bg-[#111] dark:text-gray-200
                 rounded-md shadow-sm py-2 px-3"
          required>
          <option value="" disabled {% if not default_done_by %}selected{% endif %}>Select Person</option>
          <option value="Faisal" {% if default_done_by == "Faisal" %}selected{% endif %}>Faisal</option>
          <option value="Hassan" {% if default_done_by == "Hassan" %}selected{% endif %}>Hassan</option>
          <option value="Faran" {% if default_done_by == "Faran" %}selected{% endif %}>Faran</option>
        </select>
      </div>

      <div class="text-right">
        <button type="submit"
                class="bg-[#0f8238] text-white px-4 py-2 rounded shadow hover:bg-green-700">
          Add Expense
        </button>
      </div>

    </form>
  </div>
</div>

<!-- EDIT MODALS -->
{% for expense in expenses %}
<div id="editExpenseModal{{ expense.id }}"
     class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 hidden">

  <div class="bg-white dark:bg-[#1a1a1a] rounded-lg border border-gray-200 dark:border-gray-700
              shadow-xl w-full max-w-md p-6 mx-4 relative">

    <button onclick="closeModal('editExpenseModal{{ expense.id }}')"
            class="absolute top-3 right-3 text-gray-400 dark:text-gray-500 hover:text-gray-300 text-xl">
      &times;
    </button>

    <h2 class="text-lg font-semibold mb-4 text-gray-900 dark:text-gray-100">Edit Expense</h2>

    <form method="POST" action="{{ url_for('expenses.edit_expense', id=expense.id) }}"
          class="space-y-4">

      <input type="hidden" name="id" value="{{ expense.id }}">

      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Amount</label>
        <input type="number" step="0.01" name="amount" value="{{ expense.amount }}" required
          class="w-full border border-gray-300 dark:border-gray-600 dark:bg-[#111] dark:text-gray-200
                 rounded-md shadow-sm px-2 py-2">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Category</label>
        <select name="category" class="select2 w-full border border-gray-300 dark:border-gray-600 dark:bg-[#111] dark:text-gray-200 rounded-md shadow-sm py-2 px-3" required>
          <option disabled value="">Select Category</option>

          <option data-icon="fas fa-gem" data-color="#8b5cf6" value="Acessories" {% if expense.category == "Acessories" %}selected{% endif %}>Accessories</option>
          <option data-icon="fas fa-baby-carriage" data-color="#fbbf24" value="Baby Food" {% if expense.category == "Baby Food" %}selected{% endif %}>Baby Food</option>
          <option data-icon="fas fa-file-invoice-dollar" data-color="#ef4444" value="Bills" {% if expense.category == "Bills" %}selected{% endif %}>Bills</option>
          <option data-icon="fas fa-tshirt" data-color="#3b82f6" value="Clothing" {% if expense.category == "Clothing" %}selected{% endif %}>Clothing</option>
          <option data-icon="fas fa-utensils" data-color="#10b981" value="Eat Out" {% if expense.category == "Eat Out" %}selected{% endif %}>Eat Out</option>
          <option data-icon="fas fa-gift" data-color="#f59e0b" value="Family Gift" {% if expense.category == "Family Gift" %}selected{% endif %}>Family Gift</option>
          <option data-icon="fas fa-motorcycle" data-color="#f97316" value="Food Delivery" {% if expense.category == "Food Delivery" %}selected{% endif %}>Food Delivery</option>
          <option data-icon="fas fa-shopping-cart" data-color="#22c55e" value="Grocery" {% if expense.category == "Grocery" %}selected{% endif %}>Grocery</option>
          <option data-icon="fas fa-home" data-color="#64748b" value="Household Expense" {% if expense.category == "Household Expense" %}selected{% endif %}>Household Expense</option>
          <option data-icon="fas fa-chart-line" data-color="#0ea5e9" value="Investment" {% if expense.category == "Investment" %}selected{% endif %}>Investment</option>
          <option data-icon="fas fa-hand-holding-usd" data-color="#22c55e" value="Lend Money" {% if expense.category == "Lend Money" %}selected{% endif %}>Lend Money</option>
          <option data-icon="fas fa-tree" data-color="#16a34a" value="Outdoor" {% if expense.category == "Outdoor" %}selected{% endif %}>Outdoor</option>
          <option data-icon="fas fa-tools" data-color="#9ca3af" value="Repair" {% if expense.category == "Repair" %}selected{% endif %}>Repair</option>
          <option data-icon="fas fa-shopping-bag" data-color="#8b5cf6" value="Shopping" {% if expense.category == "Shopping" %}selected{% endif %}>Shopping</option>
          <option data-icon="fas fa-cookie-bite" data-color="#f59e0b" value="Snacking" {% if expense.category == "Snacking" %}selected{% endif %}>Snacking</option>
          <option data-icon="fas fa-plane" data-color="#3b82f6" value="Travel" {% if expense.category == "Travel" %}selected{% endif %}>Travel</option>
          <option data-icon="fas fa-book" data-color="#0ea5e9" value="Education" {% if expense.category == "Education" %}selected{% endif %}>Education</option>
          <option data-icon="fas fa-heartbeat" data-color="#ef4444" value="Healthcare" {% if expense.category == "Healthcare" %}selected{% endif %}>Healthcare</option>
          <option data-icon="fas fa-film" data-color="#f472b6" value="Entertainment" {% if expense.category == "Entertainment" %}selected{% endif %}>Entertainment</option>
          <option data-icon="fas fa-paw" data-color="#84cc16" value="Pets" {% if expense.category == "Pets" %}selected{% endif %}>Pets</option>
          <option data-icon="fas fa-bus" data-color="#6b7280" value="Transportation" {% if expense.category == "Transportation" %}selected{% endif %}>Transportation</option>
          <option data-icon="fas fa-dumbbell" data-color="#10b981" value="Fitness" {% if expense.category == "Fitness" %}selected{% endif %}>Fitness</option>
          <option data-icon="fas fa-hand-holding-heart" data-color="#ef4444" value="Charity" {% if expense.category == "Charity" %}selected{% endif %}>Charity</option>
          <option data-icon="fas fa-laptop" data-color="#0284c7" value="Electronics" {% if expense.category == "Electronics" %}selected{% endif %}>Electronics</option>
          <option data-icon="fas fa-umbrella-beach" data-color="#f59e0b" value="Vacation" {% if expense.category == "Vacation" %}selected{% endif %}>Vacation</option>

          <option data-icon="fas fa-lightbulb" data-color="#f59e0b" value="Utilities" {% if expense.category == "Utilities" %}selected{% endif %}>Utilities</option>
          <option data-icon="fas fa-home" data-color="#4b5563" value="Rent" {% if expense.category == "Rent" %}selected{% endif %}>Rent</option>
          <option data-icon="fas fa-gas-pump" data-color="#f59e0b" value="Fuel" {% if expense.category == "Fuel" %}selected{% endif %}>Fuel</option>
          <option data-icon="fas fa-wifi" data-color="#6366f1" value="Internet" {% if expense.category == "Internet" %}selected{% endif %}>Internet</option>
          <option data-icon="fas fa-mobile-alt" data-color="#06b6d4" value="Phone" {% if expense.category == "Phone" %}selected{% endif %}>Phone</option>
          <option data-icon="fas fa-money-bill-wave" data-color="#16a34a" value="Salary" {% if expense.category == "Salary" %}selected{% endif %}>Salary</option>
          <option data-icon="fas fa-piggy-bank" data-color="#84cc16" value="Savings" {% if expense.category == "Savings" %}selected{% endif %}>Savings</option>
          <option data-icon="fas fa-credit-card" data-color="#ef4444" value="Loan Payment" {% if expense.category == "Loan Payment" %}selected{% endif %}>Loan Payment</option>
          <option data-icon="fas fa-shield-alt" data-color="#0ea5e9" value="Insurance" {% if expense.category == "Insurance" %}selected{% endif %}>Insurance</option>
          <option data-icon="fas fa-pills" data-color="#22c55e" value="Pharmacy" {% if expense.category == "Pharmacy" %}selected{% endif %}>Pharmacy</option>
          <option data-icon="fas fa-pen" data-color="#6b7280" value="Stationery" {% if expense.category == "Stationery" %}selected{% endif %}>Stationery</option>
          <option data-icon="fas fa-apple-alt" data-color="#22c55e" value="Fruits & Veg" {% if expense.category == "Fruits & Veg" %}selected{% endif %}>Fruits & Veg</option>
          <option data-icon="fas fa-drumstick-bite" data-color="#ef4444" value="Meat & Poultry" {% if expense.category == "Meat & Poultry" %}selected{% endif %}>Meat & Poultry</option>
          <option data-icon="fas fa-bread-slice" data-color="#f59e0b" value="Bakery" {% if expense.category == "Bakery" %}selected{% endif %}>Bakery</option>
          <option data-icon="fas fa-mug-hot" data-color="#a16207" value="Coffee/Tea" {% if expense.category == "Coffee/Tea" %}selected{% endif %}>Coffee/Tea</option>
          <option data-icon="fas fa-sim-card" data-color="#06b6d4" value="Mobile Top-up" {% if expense.category == "Mobile Top-up" %}selected{% endif %}>Mobile Top-up</option>
          <option data-icon="fas fa-redo-alt" data-color="#6366f1" value="Subscriptions" {% if expense.category == "Subscriptions" %}selected{% endif %}>Subscriptions</option>
          <option data-icon="fas fa-code" data-color="#0ea5e9" value="Software" {% if expense.category == "Software" %}selected{% endif %}>Software</option>
          <option data-icon="fas fa-cloud" data-color="#60a5fa" value="Cloud" {% if expense.category == "Cloud" %}selected{% endif %}>Cloud</option>
          <option data-icon="fas fa-server" data-color="#4b5563" value="Hosting" {% if expense.category == "Hosting" %}selected{% endif %}>Hosting</option>
          <option data-icon="fas fa-globe" data-color="#10b981" value="Domain" {% if expense.category == "Domain" %}selected{% endif %}>Domain</option>
          <option data-icon="fas fa-tint" data-color="#06b6d4" value="Laundry" {% if expense.category == "Laundry" %}selected{% endif %}>Laundry</option>
          <option data-icon="fas fa-broom" data-color="#a3a3a3" value="Cleaning" {% if expense.category == "Cleaning" %}selected{% endif %}>Cleaning</option>
          <option data-icon="fas fa-seedling" data-color="#16a34a" value="Gardening" {% if expense.category == "Gardening" %}selected{% endif %}>Gardening</option>
          <option data-icon="fas fa-hammer" data-color="#f59e0b" value="Home Improvement" {% if expense.category == "Home Improvement" %}selected{% endif %}>Home Improvement</option>
          <option data-icon="fas fa-couch" data-color="#a16207" value="Furniture" {% if expense.category == "Furniture" %}selected{% endif %}>Furniture</option>
          <option data-icon="fas fa-blender" data-color="#64748b" value="Appliances" {% if expense.category == "Appliances" %}selected{% endif %}>Appliances</option>
          <option data-icon="fas fa-shipping-fast" data-color="#8b5cf6" value="Courier/Shipping" {% if expense.category == "Courier/Shipping" %}selected{% endif %}>Courier/Shipping</option>
          <option data-icon="fas fa-taxi" data-color="#f59e0b" value="Ride-hailing" {% if expense.category == "Ride-hailing" %}selected{% endif %}>Ride-hailing</option>
          <option data-icon="fas fa-parking" data-color="#3b82f6" value="Parking" {% if expense.category == "Parking" %}selected{% endif %}>Parking</option>
          <option data-icon="fas fa-file-invoice" data-color="#ef4444" value="Taxes" {% if expense.category == "Taxes" %}selected{% endif %}>Taxes</option>
          <option data-icon="fas fa-ellipsis-h" data-color="#9ca3af" value="Miscellaneous" {% if expense.category == "Miscellaneous" %}selected{% endif %}>Miscellaneous</option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Note</label>
        <textarea name="note" rows="2"
          class="w-full border border-gray-300 dark:border-gray-600 dark:bg-[#111] dark:text-gray-200
                 rounded-md shadow-sm py-1 px-2">{{ expense.note }}</textarea>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Date</label>
        <input type="date" name="date" value="{{ expense.date }}"
          class="w-full border border-gray-300 dark:border-gray-600 dark:bg-[#111] dark:text-gray-200
                 rounded-md shadow-sm px-2 py-2">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Receipt</label>
        <input type="file"
          class="w-full text-sm border border-gray-300 dark:border-gray-600 dark:bg-[#111]
                 dark:text-gray-200 rounded-md p-1" name="attachment">
        {% if expense.attachment %}
        <a href="{{ url_for('receipt_file', filename=expense.attachment) }}"
          target="_blank"
          class="text-xs text-purple-600 dark:text-purple-400 underline block mt-1">View Current</a>
        {% endif %}
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Expense Done By</label>
        <select name="done_by"
          class="select2 w-full border border-gray-300 dark:border-gray-600 dark:bg-[#111] dark:text-gray-200
                 rounded-md shadow-sm py-2 px-3" required>
          <option value="Faisal" {% if expense.done_by == "Faisal" %}selected{% endif %}>Faisal</option>
          <option value="Hassan" {% if expense.done_by == "Hassan" %}selected{% endif %}>Hassan</option>
          <option value="Faran" {% if expense.done_by == "Faran" %}selected{% endif %}>Faran</option>
        </select>
      </div>

      <div class="text-right">
        <button type="submit" class="bg-[#0f8238] text-white px-4 py-2 rounded shadow hover:bg-green-700">
          Update
        </button>
      </div>

    </form>
  </div>
</div>
{% endfor %}

<script>
  function closeModal(id) {
    document.getElementById(id)?.classList.add('hidden');
  }

  document.querySelectorAll('[data-bs-toggle="modal"]').forEach(btn => {
    btn.addEventListener('click', () => {
      const target = btn.getAttribute('data-bs-target')?.replace('#', '');
      document.getElementById(target)?.classList.remove('hidden');
    });
  });

  function formatOption(state){
    if(!state.id) return state.text;
    const $el=$(state.element);
    const icon=$el.data('icon');
    const color=$el.data('color')||'#6b7280';
    return $(
      `<span class="opt">
        <i class="${icon} fa-fw ico" style="color:${color}"></i>
        <span>${state.text}</span>
      </span>`
    );
  }

  $(document).ready(function() {
    $('#addExpenseModal .select2').select2({
      width: '100%',
      dropdownParent: $('#addExpenseModal'),
      templateResult: formatOption,
      templateSelection: formatOption,
      escapeMarkup: m=>m
    });

    {% for expense in expenses %}
    $('#editExpenseModal{{ expense.id }} .select2').select2({
      width: '100%',
      dropdownParent: $('#editExpenseModal{{ expense.id }}'),
      templateResult: formatOption,
      templateSelection: formatOption,
      escapeMarkup: m=>m
    });
    {% endfor %}
  });
</script>

{% endblock %}
